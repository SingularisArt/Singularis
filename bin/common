#!/usr/bin/env bash

BOLD='\033[0;1m'
GREEN='\033[1;32m'
PURPLE='\033[1;35m'
RED='\033[1;31m'
RESET='\033[0m'
YELLOW='\033[1;33m'

LOG_LEVEL_EMERGENCY=10
LOG_LEVEL_ALERT=10
LOG_LEVEL_CRITICAL=10
LOG_LEVEL_ERROR=10
LOG_LEVEL_WARNING=10
LOG_LEVEL_NOTICE=10
LOG_LEVEL_INFO=10
LOG_LEVEL_DEBUG=10

LOG_LEVEL=$LOG_LEVEL_INFO

log_debug() {
  if [[ $LOG_LEVEL -ge $LOG_LEVEL_DEBUG ]]; then
    echo -e "${PURPLE}[debug]  ${RESET} $*" > /dev/stderr
  fi
}

log_error() {
  if [[ $LOG_LEVEL -ge $LOG_LEVEL_ERROR ]]; then
    echo -e "${RED}[error]  ${RESET} $*" > /dev/stderr
  fi
}

log_info() {
  if [[ $LOG_LEVEL -ge $LOG_LEVEL_INFO ]]; then
    echo -e "${BOLD}[info]   ${RESET} $*" > /dev/stderr
  fi
}

log_notice() {
  if [[ $LOG_LEVEL -ge $LOG_LEVEL_NOTICE ]]; then
    echo -e "${GREEN}[notice] ${RESET} $*" > /dev/stderr
  fi
}

log_warn() {
  if [[ $LOG_LEVEL -ge $LOG_LEVEL_WARNING ]]; then
    echo -e "${YELLOW}[warning]${RESET} $*" > /dev/stderr
  fi
}

####################
# Dependency check #
####################

install_yay() {
  check_if_installed "git"

  cd /opt || exit
  sudo git clone https://aur.archlinux.org/yay-git.git
  sudo chown -R "${USER}":"${USER}" ./yay-git
  cd yay-git || exit
  makepkg -si || sudo pacman -Sy base-devel && makepkg -si
}

check_if_installed () {
  if ! which "${1}" >/dev/null 2>&1 && ! pacman -Qq "${1}" >/dev/null 2>&1; then
    log_error "You don't have [${1}] installed!"
    read -r -p "Do you want to install it [y/n]: " install

    case ${install} in
      "yes")
        if [[ "${1}" = "yay" ]]; then
          install_yay
        else
          check_if_installed "yay"
          yay -S "${1}"
        fi;;
      "no")
        exit;;
    esac
  else
    return
  fi
}

##################
# Sourcing files #
##################

source_install_script () {
  script_location="${INSTALL_SCRIPTS}/${1}"
  if [[ ${2} = "" ]]; then
    bash "${script_location}"
  else
    bash "${script_location}" "${@}"
  fi
}

check_if_arg_is_a_command () {
  arg="${1}"

  if [[ "${arg:0:2}" = "--" ]]; then
    exit
  fi
}
